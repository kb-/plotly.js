<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Plotly Tooltip Button Test</title>
    <script src="../dist/plotly.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .plot {
            width: 100%;
            height: 600px;
            margin-bottom: 50px;
        }
    </style>
</head>
<body>
    <h1>Plotly Tooltip Button Test</h1>
    <div id="scatter-plot" class="plot"></div>
    <div id="scatterLog-plot" class="plot"></div>
    <div id="bar-plot" class="plot"></div>
    <div id="heatmap-plot" class="plot"></div>
    <div id="histogram-plot" class="plot"></div>
    <div id="histogram2d-plot" class="plot"></div>
    <div id="histogram2dcontour-plot" class="plot"></div>
    <div id="scattergl-plot" class="plot"></div>
    <div id="splom-plot" class="plot"></div>
    <div id="pointcloud-plot" class="plot"></div>
    <div id="ohlc-plot" class="plot"></div>
    <div id="candlestick-plot" class="plot"></div>
    <div id="scatterternary-plot" class="plot"></div>
    <div id="scatterpolargl-plot" class="plot"></div>
    <div id="carpet-plot" class="plot"></div>
    <div id="scattercarpet-plot" class="plot"></div>
    <div id="contourcarpet-plot" class="plot"></div>
    <div id="parcoords-plot" class="plot"></div>
    <div id="surface-plot" class="plot"></div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            
            function generateDateTime(start, count) {
                let dates = [];
                let current = new Date(start);
                for (let i = 0; i < count; i++) {
                    dates.push(new Date(current));
                    current.setHours(current.getHours() + 7);
                }
                return dates;
            }
            
            function generateRandomYValues(count) {
                return Array.from({ length: count }, () => Math.random() * 20);
            }
			
			var scatterTooltipTemplate = "%{fullData.name}<br>%{x|%H:%M:%S}<br>y: %{y:.2e}";

            var scatterData = [{
                name: 'Scatter Trace 1',
                x: generateDateTime('2025-04-01T12:00:00Z', 5),
                y: generateRandomYValues(5),
                type: 'scatter',
                tooltiptemplate: scatterTooltipTemplate,
			},
			{
                name: 'Scatter Trace 2',
                x: generateDateTime('2025-04-01T12:00:00Z', 5),
                y: generateRandomYValues(5),
                type: 'scatter',
                tooltiptemplate: scatterTooltipTemplate,
            }];
            
            var scatterLogTooltipTemplate = "%{fullData.name}<br>%{x:.2e}<br>y: %{y:.2e}";
            var scatterLogData = [{
              x: [0, 1, 2, 3, 4, 5, 6, 7, 8],
              y: [8, 7, 6, 5, 4, 3, 2, 1, 0],
              type: 'scatter',
              tooltiptemplate: scatterLogTooltipTemplate,
            },
            {
              x: [0, 1, 2, 3, 4, 5, 6, 7, 8],
              y: [0, 1, 2, 3, 4, 5, 6, 7, 8],
              type: 'scatter',
              tooltiptemplate: scatterLogTooltipTemplate,
            }];
            
            var scatterLogLayout = {
              xaxis: {
                type: 'log',
                autorange: true
              },
              yaxis: {
                type: 'log',
                autorange: true
              }
            };

            var barData = [{
                x: ['A', 'B', 'C', 'D'],
                y: [10, 20, 15, 25],
                type: 'bar',
                tooltiptemplate: "%{x}<br>y: %{y}",
            }];

            // Generate heatmap data
            var x = Array.from({ length: 400 }, (_, i) => i / 40);
            var y = Array.from({ length: 400 }, (_, i) => i / 40);
            var z = Array.from({ length: 400 }, (_, i) => 
                Array.from({ length: 400 }, (_, j) => 
                    Math.sin(i / 40) * Math.cos(j / 40)
                )
            );

            var heatmapData = [{
                z: z,
                x: x,
                y: y,
                type: 'heatmap',
                colorscale: 'Viridis',
				tooltip: {
                    bgcolor: "rgba(255, 255, 255, 0.2)"
                },
                tooltiptemplate: "x: %{x:.2f},<br>y: %{y:.2f},<br>z: %{z:.3f}"
            }];

            var histogramData = [{
                name:'H1',
                x: generateRandomYValues(100),
                type: 'histogram',
                tooltiptemplate: "Count: %{y}"
            },
            {
                name:'H2',
                x: generateRandomYValues(100),
                type: 'histogram',
                tooltiptemplate: "Count: %{y}"
            },
            {
                name:'H2',
                x: generateRandomYValues(100),
                type: 'histogram',
                tooltiptemplate: "%{fullData.name}<br>x: %{x}<br>Count: %{y}"
            }
            ];

            var histogram2dData = [{
                x: generateRandomYValues(200),
                y: generateRandomYValues(200),
                type: 'histogram2d',
                colorscale: 'Blues',
                tooltiptemplate: "x: %{x}<br>y: %{y}<br>Count: %{z}"
            }];

            var histogram2dContourData = [{
                x: generateRandomYValues(200),
                y: generateRandomYValues(200),
                type: 'histogram2dcontour',
                colorscale: 'Electric',
                tooltip: {
                    bgcolor: "rgba(255, 255, 255, 0.2)"
                },
                tooltiptemplate: "x: %{x}<br>y: %{y}<br>Count: %{z}"
            }];
            
            var scatterglData = [{
                name: 'ScatterGL Trace',
                x: generateDateTime('2025-04-01T12:00:00Z', 1000),
                y: generateRandomYValues(1000),
                type: 'scattergl',
                tooltiptemplate: "%{fullData.name}<br>%{x|%H:%M:%S}<br>y: %{y:.2e}",
            }];

            var splomData = [{
                type: 'splom',
                dimensions: [
                    {label: 'A', values: generateRandomYValues(100)},
                    {label: 'B', values: generateRandomYValues(100)},
                    {label: 'C', values: generateRandomYValues(100)},
                    {label: 'D', values: generateRandomYValues(100)}
                ],
                tooltiptemplate: "x: %{x}<br>y: %{y}"
            }];

            var pointcloudData = [{
                x: generateRandomYValues(1000),
                y: generateRandomYValues(1000),
                type: 'pointcloud',
                tooltiptemplate: "x: %{x}<br>y: %{y}"
            }];
            
            var ohlcData = [{
                x: ['2017-01-17', '2017-01-18', '2017-01-19', '2017-01-20', '2017-01-23', '2017-01-24', '2017-01-25', '2017-01-26', '2017-01-27', '2017-01-30', '2017-01-31', '2017-02-01', '2017-02-02', '2017-02-03', '2017-02-06', '2017-02-07', '2017-02-08', '2017-02-09', '2017-02-10'], 
                close: [120, 119.989998, 119.779999, 120, 120.080002, 119.970001, 121.879997, 121.940002, 121.949997, 121.629997, 121.349998, 128.75, 128.529999, 129.080002, 130.289993, 131.529999, 132.039993, 132.419998, 132.119995], 
                decreasing: {line: {color: '#7F7F7F'}}, 
                high: [120.239998, 120.5, 120.089996, 120.449997, 120.809998, 120.099998, 122.099998, 122.440002, 122.349998, 121.629997, 121.389999, 130.490005, 129.389999, 129.190002, 130.5, 132.089996, 132.220001, 132.449997, 132.940002],
                increasing: {line: {color: '#17BECF'}}, 
                line: {color: 'rgba(31,119,180,1)'}, 
                low: [118.220001, 119.709999, 119.370003, 119.730003, 119.769997, 119.5, 120.279999, 121.599998, 121.599998, 120.660004, 120.620003, 127.010002, 127.779999, 128.160004, 128.899994, 130.449997, 131.220001, 131.119995, 132.050003], 
                open: [118.339996, 120, 119.400002, 120.449997, 120, 119.550003, 120.419998, 121.669998, 122.139999, 120.93, 121.150002, 127.029999, 127.980003, 128.309998, 129.130005, 130.539993, 131.350006, 131.649994, 132.460007], 
                type: 'ohlc', 
                //xaxis: 'x', 
                //yaxis: 'y',
                tooltiptemplate: "Open: %{open}<br>High: %{high}<br>Low: %{low}<br>Close: %{close}<br>Date: %{x|%Y-%m-%d}"
            }];

            var candlestickData = structuredClone(ohlcData);
            candlestickData[0].type = 'candlestick';            

            var scatterternaryData = [{
                type: 'scatterternary',
                mode: 'markers',
                a: generateRandomYValues(10),
                b: generateRandomYValues(10),
                c: generateRandomYValues(10),
                text: generateRandomYValues(10).map(String),
                marker: {
                    symbol: 100,
                    color: 'blue',
                    size: 14,
                    line: {width: 2}
                },
                tooltiptemplate: "A: %{a}<br>B: %{b}<br>C: %{c}"
            }];

            var scatterpolarglData = [{
                type: 'scatterpolargl',
                r: generateRandomYValues(10),
                theta: generateRandomYValues(10),
                mode: 'markers',
                marker: {
                    color: 'orange',
                    size: 12,
                    symbol: 'circle'
                },
                tooltiptemplate: "r: %{r}<br>Theta: %{theta}"
            }];
            
            var carpetData = [{
                type: 'carpet',
                a: [4, 4, 4, 4.5, 4.5, 4.5, 5, 5, 5, 6, 6, 6].map(a => a * 1e-6),
                b: [1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3].map(b => b * 1e6),
                y: [2, 3.5, 4, 3, 4.5, 5, 5.5, 6.5, 7.5, 8, 8.5, 10],
                aaxis: {
                    tickprefix: 'a = ',
                    ticksuffix: 'm',
                    smoothing: 1,
                    minorgridcount: 9,
                },
                baxis: {
                    tickprefix: 'b = ',
                    ticksuffix: 'Pa',
                    smoothing: 1,
                    minorgridcount: 9,
                },
                tooltiptemplate: "A: %{a:.2s}m<br>B: %{b:.2s}Pa<br>y: %{y:.2s}"
            }];

            var scattercarpetData = [
                {
                    type: 'carpet',
                    a: [4, 4, 4, 4.5, 4.5, 4.5, 5, 5, 5, 6, 6, 6].map(a => a * 1e-6),
                    b: [1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3].map(b => b * 1e6),
                    y: [2, 3.5, 4, 3, 4.5, 5, 5.5, 6.5, 7.5, 8, 8.5, 10],
                    aaxis: {
                        tickprefix: 'a = ',
                        ticksuffix: 'm',
                        smoothing: 1,
                        minorgridcount: 9,
                    },
                    baxis: {
                        tickprefix: 'b = ',
                        ticksuffix: 'Pa',
                        smoothing: 1,
                        minorgridcount: 9,
                    }
                },
                {
                    type: 'scattercarpet',
                    a: [4, 4.5, 5, 6].map(a => a * 1e-6),
                    b: [1.5, 2.5, 1.5, 2.5].map(b => b * 1e6),
                    line: {shape: 'spline', smoothing: 1},
                    tooltiptemplate: "A: %{a:.2s}m<br>B: %{b:.2s}Pa<br>y: %{y:.2s}"
                }
            ];

            var contourcarpetData = [
                {
                    type: 'contourcarpet',
                    a: [0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3],
                    b: [4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6, 6],
                    z: [1, 1.96, 2.56, 3.0625, 4, 5.0625, 1, 7.5625, 9, 12.25, 15.21, 14.0625],
                    autocontour: false,
                    contours: {
                        start: 1,
                        end: 14,
                        size: 1
                    },
                    line: {
                        width: 2,
                        smoothing: 0
                    },
                    colorbar: {
                        len: 0.4,
                        y: 0.25
                    },
                    tooltiptemplate: "A: %{a}<br>B: %{b}<br>Z: %{z}",
                },
                {
                    type: 'carpet',
                    a: [0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3],
                    b: [4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 6, 6],
                    x: [2, 3, 4, 5, 2.2, 3.1, 4.1, 5.1, 1.5, 2.5, 3.5, 4.5],
                    y: [1, 1.4, 1.6, 1.75, 2, 2.5, 2.7, 2.75, 3, 3.5, 3.7, 3.75],
                    aaxis: {
                        tickprefix: "a = ",
                        smoothing: 0,
                        minorgridcount: 9,
                        type: 'linear'
                    },
                    baxis: {
                        tickprefix: "b = ",
                        smoothing: 0,
                        minorgridcount: 9,
                        type: 'linear'
                    }
                }
            ];
            
            contourcarpetLayout = {
                margin: { t: 40, r: 30, b: 30, l: 30 },
                yaxis: { range: [0.388, 4.361] },
                xaxis: { range: [0.667, 5.932] }
            }
            
            var parcoordsData = [{
                type: 'parcoords',
                line: {
                    color: 'blue'
                },
                dimensions: [{
                    range: [1, 5],
                    constraintrange: [1, 2],
                    label: 'A',
                    values: [1, 4]
                }, {
                    range: [1, 5],
                    label: 'B',
                    values: [3, 1.5],
                    tickvals: [1.5, 3, 4.5]
                }, {
                    range: [1, 5],
                    label: 'C',
                    values: [2, 4],
                    tickvals: [1, 2, 4, 5],
                    ticktext: ['text 1', 'text 2', 'text 4', 'text 5']
                }, {
                    range: [1, 5],
                    label: 'D',
                    values: [4, 2]
                }],
                tooltiptemplate: "Dim A: %{a}<br>Dim B: %{b}<br>Dim C: %{c}<br>Dim D: %{d}"
            }];
            
            d3.csv('https://raw.githubusercontent.com/plotly/datasets/master/api_docs/mt_bruno_elevation.csv', function(err, rows) {
                if (err) {
                    console.error('Error loading CSV data:', err);
                    return;
                }

                // Convert the object into an array of rows
                rows = Object.values(rows);

                function unpack(rows, key) {
                    return rows.map(function(row) { return row[key]; });
                }

                var z_data = [];
                for (var i = 0; i < 24; i++) {
                    z_data.push(unpack(rows, i));
                }

                var surfaceData = [{
                    z: z_data,
                    type: 'surface',
                    tooltiptemplate: "x: %{x}<br>y: %{y}<br>z: %{z}"
                }];

                var surfaceLayout = {
                    title: 'Mt Bruno Elevation',
                    autosize: false,
                    width: 500,
                    height: 500,
                    margin: {
                        l: 65,
                        r: 50,
                        b: 65,
                        t: 90
                    }
                };

                Plotly.newPlot('surface-plot', surfaceData, Object.assign(surfaceLayout, {'title':'NOT ACTIVE'}));
            });
 

            var layout = {
            };

            var config = {
                editable: true,
                modeBarButtonsToAdd: ['tooltip', 'hoverclosest', 'hovercompare', 'togglespikelines'],
                displaylogo: false,
                displayModeBar: true,
            };

            Plotly.newPlot('scatter-plot', scatterData, Object.assign({}, layout), config);
            Plotly.newPlot('scatterLog-plot', scatterLogData, Object.assign({},scatterLogLayout), config);
            Plotly.newPlot('bar-plot', barData, Object.assign({}, layout, { xaxis: { type: 'category' } }), config);
            Plotly.newPlot('heatmap-plot', heatmapData, Object.assign({}, layout), config);
            Plotly.newPlot('histogram-plot', histogramData, {'title':'(has arrow snapping position issues, not always matching hover label position)'}, config);
            Plotly.newPlot('histogram2d-plot', histogram2dData, Object.assign({}, layout), config);
            Plotly.newPlot('histogram2dcontour-plot', histogram2dContourData, Object.assign({}, {'title':'(has some arrow snapping position issues, but identical to hover label position)'}), config);
            Plotly.newPlot('scattergl-plot', scatterglData, Object.assign({}, layout), config);
            Plotly.newPlot('splom-plot', splomData, {'title':'(only works for the 1st plot. Arrow always snaps in the 1st plot despite right hover label position)'}, config);
            Plotly.newPlot('pointcloud-plot', pointcloudData, {'title':{'text':'ok when forced (figure not in cartesian group)', 'font':{'color':'green'}}}, config);
            Plotly.newPlot('ohlc-plot', ohlcData, Object.assign({}, {'title':'(Arrow snaps mid-height)'}), config);
            Plotly.newPlot('candlestick-plot', candlestickData, Object.assign({}, {'title':'(Arrow snaps mid-height)'}), config);
            Plotly.newPlot('scatterternary-plot', scatterternaryData, {'title':'Not compatible. Breaks graph'}, config);
            Plotly.newPlot('scatterpolargl-plot', scatterpolarglData, {'title':'Not compatible. Breaks graph'}, config);
            Plotly.newPlot('carpet-plot', carpetData, {'title':'Click has no effect. hover not shown'}, config);
            Plotly.newPlot('scattercarpet-plot', scattercarpetData, {'title':'(Arrow snaps at wrong position)'}, config);
            Plotly.newPlot('contourcarpet-plot', contourcarpetData, Object.assign(contourcarpetLayout, {'title':'Click has no effect. hover not shown'}), config);
            Plotly.newPlot('parcoords-plot', parcoordsData, {'title':'Click has no effect. hover not shown'}, config);

        });
    </script>
</body>
</html>
